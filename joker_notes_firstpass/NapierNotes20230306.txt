Napier: 3/06/2023

- Goals: KalmanNet
 
- Experimenters: Luis, Julianna

- Recording Start Time: 9:50 am
- Recording Stop Time:   am

- xPC Model: Rig_main_Cortical_Parasite_v2
- Recorded Array: Motor (Patient cable/cerebus)
- Data recorded: Spikes (250Hz highpass, RMS -4.5) + 2kSps 300-1000HzBPass + EMG 10ksps
- Drink: Apple Juice

- Params: 
	* Movement Mask: [0,1,0,0,0]
	* Target Hold Time (OL/CL): 750/500
	* Target Scaling(OL/CL): 100
	* Juice Time: 90
	* Trial Timeout: 5000/10000
	* Auto Juice: 0
   	* Target Pos Style (OL/CL): 29, 35, 37
	* Visualization Style: MRP
	
-Decoders:
	- KF0: TrainOnline_Cortical_KalmanFilter_Multi('Joker','2023-03-06',4,false,[2 4],50,0,good_chans_SBP,good_chans_SBP,1,{'act_thresh',1},0,true)
		correlation = 0.71502
		lag = 2
	- KF1: TrainOnline_Cortical_KalmanFilter_Multi('Joker','2023-03-06',3,false,[2 4],50,0,good_chans_SBP,good_chans_SBP,1,{'act_thresh',1},0,true)
		correlation = 0.71146
		lag = 0
	- KFN0: trained on run 4. 
		[0.71, 0.77, 0.38, 0.43]
		lag = 0
	- KNet0: trained on run 4, linear model.
		Best corr: 0.81 at iteration 160.
	- KNet1: trained on run 4, nonlinear model.
		Best corr: 0.774, at iteration 190.
	- KNet2: trained on run 5, linear model.
		Best corr: 0.668, at iteration 170 ([0.54, 0.73, 0.67, 0.73])
	- KNet3: same as KNet1.
		Best corr: 0.806 at iteration 250.
		
	
-Runs:	
	Run 1: calibration
	Run 2: calibration, hadn't started the recording yet.
	Run 3: 500 TS29 hand control. Bitrate ~4.3.
	Run 4: 500 TS37 hand control. Bitrate ~3.
	Run 5: 500 TS35 hand control. Bitrate ~3.5-4.5.
	-- KF0 (trained on run 4)
	Run 6: 90 TS29. Index isn't looking great: mostly biased towards flexion. General bad performance, getting very few trials. Success rate at 25% on trial 70 and going down. Bitrate at 0.4.
	Run 7: 65 TS29. Index still biased towards flexion. Can't do trials. After a while he managed to unbias the index and start doing trials. Then, the index got biased again. Bitrate at 0.7, success rate at 40%.
	-- KF1 (trained on run 3)
	Run 8: 35 TS29. Started doing some trials, but after a little while it got biased on both fingers. Bitrate at 0.43, success rate at 0.29.
	-- KFN0
	Run 9: 50 TS29, beta=1. Completely biased towards extension for bot fingers. Tried beta=0.98, and the fingers got biased towards flexion. MRS seems to be able to move, but not the index. Can't do any trials.
	-- KNet0
	Run 10: 200 TS29, beta=0.98. Seems very jumpy, but at least can do trials. Increased the timeout to 10 seconds, as he was being slow but able to complete trials. Has trouble with the targets that are MRS extension, index flexion. Bitrate ~1, success rate 0.92. Success!
	Run 11: ~10 TS29, beta=1.0. MRS seems to move really well, but index is completely biased towards flexion. Crashed.
	Run 12: TS29, beta=0.99. Fingers somewhat stuck in the middle for a little bit. After a while, starts doing trials. Movement seems much more natural and nicer than in Run 10. However, it can't reach as many targets. Seems to have trouble individuating finger movement as well. At around trial 90 he stopped moving the fingers. Left it running accidentally, but with the screen off.
	
	-- 5 minute break
	
	-- KF1
	Run 13: 37 TS29. MRS and index biased towards extension, has trouble getting to the targets. Success rate at 29%.
	-- KNet1
	Run 14: 155 TS29, beta=0.98. Fingers start stuck in the middle, but then he starts doing some trials. Has trouble separating fingers. Also, Napier seems to be frustrated with the decoder. Seems to do slightly worse than KNet0. Bitrate ~0.9, success rate 75%. Napier seemed to get bored by the end.
	
	-- 5 minute break.
	
	-- KNet2
	Run 15: 30 TS35, beta=1. Worked well for a few trials, but then got bad. Don't know if it is the decoder or Napier. Fingers are not biased, but they are not moving much.
	-- RFNt0
	Run 16: TS29, beta=1. Fingers kind of not doing anything related to the task, and getting stuck in the extremes. 
	Run 17: 45 TS29, beta=0.98. It sort of can do bursts of trials, but most of the time it's moving very slowly.

	-- long break
	
	-- KNet3
	Run 18: 30 TS29, beta=0.98. Seems to be moving too slow, with sporadic fast speed movements. Decoder is not doing very well, but at least he can do some trials.
	
	
Summary:
	- 


TODO:
	- 

Notes:
	Channels with >1Hz firing rate
	- good_chans_SBP = [1,2,4,7,33,38,65,67,68,69,71,72,73,75,77,79,82,90];
	- Only 18 good channels, seems pretty bad.
	
	
	



