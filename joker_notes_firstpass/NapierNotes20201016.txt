Napier: 10/16/2020

- Goals: Decoding index finger with various KFs

- Experiment: Sam, Dylan, Hisham

- Recording Start Time: 11:10 am
- Recording Stop Time:  1:00 pm

- xPC Model: Rig_main_Cortical_SBP_Spikes_CAR
- Recorded Array: Motor (Patient Cable)
- Data recorded: Spikes (250Hz highpass, RMS -4.5) + Raw + 2kSps 300-1000HzBPas continuous
- Drink: Apple Juice

- Params: 
	* Movement Mask: [0,1,0,1,0]
	* Target Hold Time (OL/CL): 750
	* Target Scaling(OL/CL): 100
	* Juice Time: 100
	* Trial Timeout: 10000
	* Auto Juice: 0
   	* Target Pos Style (OL/CL): 30
	* Visualization Style: MRS
	
-Decoders: 
	KF0: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',2,false,[2,4],32,0,good_chans_SBP,good_chans_SBP,1,{'act_thresh',1},true);	% normal online decoder training we have been using for 1.5 years
	KF1: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',2,false,[2,4],32,0,good_chans_SBP,good_chans_SBP,3,{'act_thresh',1},true);	% machine-learned A-matrix
	KF2: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',2,false,[2,4],32,0,good_chans_SBP,good_chans_SBP,0,{'act_thresh',1},true);	% i_vel and mrs_vel are completely independent in the A matrix
	KF3: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',2,false,[2,4],32,0,good_chans_SBP,good_chans_SBP,1,{'act_thresh',1,'orth', []},true);	% orthonormal regression, trained on CNPL-Superman with Matlab R2019b
	KF6: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',10,false,[2,4],32,0,good_chans_SBP,good_chans_SBP,3,{'act_thresh',1},true);	% machine-learned A-matrix
	
	RF0: TrainOnline_Cortical_KalmanFilterReFIT_Multi('Joker','',4,4,0,[2,4],32,xpcBinLag,xpcA,xpcW,good_chans_SBP,good_chans_SBP, 1, {[], []}, true);
	RF1: TrainOnline_Cortical_KalmanFilterReFIT_Multi('Joker','',4,4,0,[2,4],32,[0, 0],xpcA,xpcW,good_chans_SBP,good_chans_SBP, 1, {[], []}, true);
	RF2: TrainOnline_Cortical_KalmanFilterReFIT_Multi('Joker','',11,11,0,[2,4],32,[0, 0],xpcA,xpcW,good_chans_SBP,good_chans_SBP, 1, {[], []}, true);
	
-Runs:
	Run 1: Calibration
	Run 2: Training on TS30.
	Run 3: KF0 SBP: Index started at full max, turned CL on once the prediction was in the 0.5 range. Performance is okay too. Just waiting for it to break down... Index locked to extension at 66.
	Run 4: KF1 SBP: Worked right off the bat. Nothing too impressive with the bit rate, but he's had no problems. TCR at 272. Not working. Needed a decoder reset, now it's working ok.
	Run 5: KF2 SBP: Having trouble controlling it, but it isn't maxing out. It maxes at 20, but he can pull it out. Maxes again at 29, but he can pull it out. Maxes at 36, can pull it out.
	Run 6: KF0 SBP: Offline is maxed before even putting it on CL.
	Run 7: KF3 SBP: Index still maxed out. I can't believe this is an A matrix problem.
	Run 8: RF0 SBP: Slow start, but controllable. Average 2.2bps at the end.
	Run 9: RF1 SBP: Slow to start, but learning to control it. Looks like RF0 was trained to have 0 latency for the SBP KF anyway. Performance slowing down, 1.9 or so to average at the end. TS32 at trial 281. Having trouble with far MRS extensions. MRS now flexes when trying to extend, around 374. Reset decoder 376-377. Still having MRS extend problems.
	Run 10: TS34 training.
	Run 11: KF6 SBP: Looks ok, lots of orbiting though, more than normal for KF. Going to lower to 500HT. Much higher velocities than other KFs. Physical fingers locked at extension so switched out with TS0. Seems quite flexion biased. TCR at 158.
	Run 12: RF2 SBP: Slower velocities, but control is better than the end of run 11. Over 2.0 bit rate, which is good for this task. 750HT at 237. Couldn't take the hold time in velocity control so switched back. TS36 at 287. Having lots of trouble with double far flexion targets. Juice Time 150 at 610. Out of juice around 710.
	
-Notes:
	good_chans_SBP = [1:9,11,13,15,17,23,24,33,35,37:40,43,45:47,49:53,55:60,62,64,65,67:69,71:76,78:88,90:92,95,96];
	