Napier: 06/01/2022

- Goals: RNN with normalization and training noise
 
- Experimenters: Joey, Hisham

- Recording Start Time: 9:30 am
- Recording Stop Time:  11:30 am

- xPC Model: Rig_main_Cortical_Parasite
- Recorded Array: Motor (Patient Cable)
- Data recorded: Spikes (250Hz highpass, RMS -4.5) + 2kSps 300-1000HzBPas continuous
- Drink: Apple Juice

- Params: 
	* Movement Mask: [0,1,0,1,0]
	* Target Hold Time (OL/CL): 750/500
	* Target Scaling(OL/CL): 100
	* Juice Time: 100
	* Trial Timeout: 10000
	* Auto Juice: 0
   	* Target Pos Style (OL/CL): 29
	* Visualization Style: MRP
	
-Decoders:	
	- all decoders trained with tri vel redistribution, RR scaler, RNNs with 5 time history
	NN0 - willsey net, 3500 iters
	NN1 - willsey net, 3500 iters, 10 sec neural norm
	RNN0 - GRU with 10 sec neural norm
	RNN1 - GRU with 10 sec neural norm + random hidden init (0.2)
	RNN2 - GRU with 10 sec neural norm + random hidden init (0.4) - no drop in correlation
	RNN3 - GRU with 10 sec neural norm + training noise
	RNN4 - GRU with 10 sec neural norm + training noise*2

	(2nd training, run 13)
	RNN5 - GRU with 10 sec neural norm
	
	
-Runs:
	Run 1: calibration
	Run 2: warmup. 60 trials.
	Run 3: TS29 training - 500 trials. BR~4.2  #HC1#
	--- 10 min training break ---
	
	---- For the following online tests, runs were started in brain control without any hand trials. ----
	Run 4: NN0. Worked for a couple trials then stuck at flex. 									*Good example to look at - did neural activity shift at trial 3?
	Run 5: NN1. 120 trials. #NN1# BR~1.9. Start at trial 10. Working fine, but getting stuck momentarily/occasionally every ~10 trials. Sometimes stuck in splits
		*could look at which trials it failed/drifted, and see if activity changed
	Run 6: RNN0. 110 trials. #RNN0# BR~1.7. Start around trial 16. Looks cleaner than the FNN. Similar drifing/stuck as run 5. Really good, then stuck, repeat. Trouble 40-90
	Run 7: RNN1. 80 trials. (No obvious improvement) Idx drifting toward extend. Added +0.001 bias trial 20. Both fingers either very fast, or slowly drifting.
	Run 8: RNN2. 30 trials. Same problems as Run 6. A bit faster than RNN0 (more overshooting)
	Run 9: RNN3. 75 trials. Drifting toward extension slightly (both fings). 0.001 bias added to both fings trial 30. Working for a little then getting stuck. Working well 
	Run 10: RNN4. 40 trials. Similar to previous runs (working for a little, then stuck).
	
	Run 11: RNN0 - 20 sec norm. 90 trials. Took some hand control to get going, but then working really well trial 17-50 (then stuck).
	Run 12: RNN0 -  3 sec norm. 40 trials. Tending to get stuck at splits. Might be able to recover from stuck faster (~60min after original training)
	
	Run 13: TS29 training - 500 trials. BR~3.9  #HC2#
	Run 14: RNN5 -  3 sec norm. 50 trials. Drfiting toward extension. added 0.001 bias to both fings trial 40. Working on and off (like before).
	Run 15: RNN5 - 60 sec norm. 80 trials. 0.001 bias. Working trial 10. Working really well trial 10-75, then stopped after he had trouble fine-tune adjustments.
	Run 16: RNN5 - 90 sec norm. 125 trials. 0.001 bias. Needed hand contorl to get it started. Working really well trial 15-90 (BR~2.4). Needed hand control to get going again.
	Run 17: RNN5 -120 sec norm. 100 trials. 0.001 bias. Needed hand control to get started. Hard time on extension (need to remove bias). Got stuck after he missed one.
	Run 18: RNN5 -120 sec norm. 140 trials. NO bias. BR~2.3. #RNN5# Needed hand control to get started. Start trial 20. Both fingers slow on extension (especially MRP).

Summary:
 - another example of the normal FNN not working, but then fine after neural normalization
 - RNN finally worked really well - needed longer normalization times, and some hand control to get started.
	- maybe multi-day training could expose it to different data distributions and be more robust
 
 TODO:
 - debug pybmi refit code

 

	
	
-Notes:
	good_chans_SBP = [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 13, 15, 17, 23, 24, 33, 35, 37, 38, 39, 40, 43, 45, 46, 47, 49, 50,
					51, 52, 53, 55, 56, 57, 58, 59, 60, 62, 64, 65, 67, 68, 69, 71, 72, 73, 74, 75, 76, 78, 79,
					80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 95, 96]

	Some juicer artifact