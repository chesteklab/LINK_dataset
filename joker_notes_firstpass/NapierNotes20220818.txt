Napier: 08/18/2022

- Goals: RNN/GRU/LSTM/FNN/KF
 
- Experimenters: Joey, Mender

- Recording Start Time: 9:50 am
- Recording Stop Time:  12:00 pm

- xPC Model: Rig_main_Cortical_Parasite_v2
- Recorded Array: Motor (Patient cable/cerebus)
- Data recorded: Spikes (250Hz highpass, RMS -4.5) + 2kSps 300-1000HzBPas continuous
- Drink: Apple Juice

- Params: 
	* Movement Mask: [0,1,0,1,0]
	* Target Hold Time (OL/CL): 750/500
	* Target Scaling(OL/CL): 100
	* Juice Time: 100
	* Trial Timeout: 10000
	* Auto Juice: 0
   	* Target Pos Style (OL/CL): 29
	* Visualization Style: MRP
	
-Decoders:	
	- all decoders trained with tri vel redistribution, RR scaler, RNNs with *20* time history
	RNN0 - GRU with x&y norm, noise		(~0.81 corr)
	RNN1 - GRU with x norm, noise		
	RNN2 - LSTM with x&y norm, noise	(~0.82 corr)
	RNN3 - RNN with x&y norm, noise		(~0.80 corr)
	NN0 - FNN with x&y norm, 400/400/100 structure. Note: FNNs were pretty unstable during training today so limited training to 2k iters. ~.6/.56 corr
	NN1 - willseynet with xnorm. 		(0.62/0.62 corr) (more stable training than the "optimized" FNN
	KF0: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',3,false,[2 4],32,0,good_chans_SBP,good_chans_SBP,1,{'act_thresh',1},0,true); 
		SBP KF correlation = 0.85206
		SBP KF lag = 1
	
	
-Runs:
	Run 1: calibration
	Run 2: warmup - 300 trials. 2 min break.
	Run 3: TS29 training - 500 trials. BR~4.3  #HC1#.
	-- 10min training break --
	
	(GH = gradual hand, norm always locked)
Comparison: GRU-LSTM-RNN-NN-KF-GRU-LSTM-RNN
	Run 4: RNN0 GRU, 30secGH. Looks good, but fingers are somewhat correlated, so hard to fine tune one finger. Working for a few trials at a time then stuck. Figured it out trial 85-178, (really clean and fast), then having some trouble. Some really fast ones trial 130-145. BR~2.6 until it stopped trial 178. Biased toward flexion.
	Run 5: RNN2 LSTM, 30secGH. Looking really good trial 30+. Looks a tad more jittery than gru, but able to fine tune much better. fingers less correlated. really good 180-200. 250 trials (use trials 50-200 for comparison). BR~2.4
	Run 6: Was forgetting to move his hand?
	Run 7: RNN3 RNN, 30secGH. Working for a few trials at a time, then kinda stuck toward flex (maybe it's when he tries hard, hidden state gets off). The trials that do work look really fast and clean. If the trial doesn't work immediately, then he has a hard time fine-tuning and it gets stuck. Working well 135-186. fully stuck 187-198. stopping.
	Run 8: NN0, 30secGH. Struggling then figured it out around trial 50 (maybe he had to adjust his thinking). Slower than the rnns, doesn't stop as well. Having trouble - stopped at 100.
	Run 9 NN1, 30secGH. working for a few trials then getting stuck at flex. Hard to control (not jittery). Getting stuck and not usable. Stopped at 55.
	Run 10: KF0, 30secGH. Working 20-30, then problems with tending to be biased toward flex. Working 50-80, works but doens't stop very well. Can look at failed trials that had an acquisition but just couldn't hold still. Stopped at 100, getting stuck even after some hand control.
	-- ~90min into the experiment --
	Run 11: RNN0 GRU, 30secGH. Working well 20-29 then stuck. 30-70 working for a few then get stuck after missing and trying to fine tune. Figured it out 75. 75-117 good. Stopped at 146 (looked like he started closing his eyes a while after it got stuck. Back open when video on)
	Run 12: RNN2 LSTM, 30secGH. Working well, able to fine tune and not get stuck. Very fast. Some fast trials 108-130. 250 trials. BR~2.3->2.0. Losing some motivation around 160, then kept going. 
	Run 13: RNN3 RNN, 30secGH. Similar to first run, working a little then getting stuck. 
	
	-- ~2 hours into the experiment --
	Run 14: TS34 training - 300 trials. BR~4.5
	Run 15: some hand, messup/ignore.
	Run 16: TS34 - RNN4 GRU, 30secGH. somewhat slow, drifting slightly. Working trial 40 off and on. Still some trouble fine-tuning. Working alright trial 65-75 then stuck/not moving. Working 90-97 after hand control until it couldn't do a big movement then stuck. (Still appears to be motivated and is trying to hit targets)
	Run 17: TS34 - RNN5 LSTM, 30secGH. Similar to run 16. 
	(Just wanted to quickly see if center-out training would work better, but might not've had enough training data/too far into the experiment time)


Summary:
	- LSTM worked much better than GRU/RNN (wasn't getting stuck, ~2.4 bps). FNN/KF didn't work
	- all decoders work well for the initial fast movement
	- decoders getting stuck after missing and trying to fine tune
	- may way to try changing training to include more instances of one finger moving while the other is still
	- there's a clear moment when he seems to figure it out, and might learn totally different strategies for each decoder
		- could be an example day for when learning one decoder then makes it hard to switch to another decoder
	
	"A run was stopped if the decoder was stuck for more than 30sec to prevent the monkey from losing motivation. "

		
TODO:

	
	
-Notes:	

	Updated 8/18/22 (today) (lots of changes):
	good_chans_SBP = [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 13, 14, 15, 17, 19, 20, 22, 23, 24, 27, 28, 29, 31, 33, 35, 36, 37, 38, 39, 40, 42, 43, 45, 46, 47, 48, 49, 50, 51, 52, 53, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 71, 72, 73, 74, 75, 76, 78, 82, 83, 84, 85, 86, 87, 88, 90, 91, 93, 94, 95, 96]
	
