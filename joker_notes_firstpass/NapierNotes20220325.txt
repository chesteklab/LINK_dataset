Napier: 03/25/2022

- Goals: KF/FNN/RNN
 
- Experiment: Joey, Eric

- Recording Start Time: 9:30 am
- Recording Stop Time:  12 pm

- xPC Model: Rig_main_Cortical_Parasite
- Recorded Array: Motor (Patient Cable)
- Data recorded: Spikes (250Hz highpass, RMS -4.5) + 2kSps 300-1000HzBPas continuous
- Drink: Apple Juice

- Params: 
	* Movement Mask: [0,1,0,1,0]
	* Target Hold Time (OL/CL): 750/500
	* Target Scaling(OL/CL): 100
	* Juice Time: 100
	* Trial Timeout: 10000
	* Auto Juice: 0
   	* Target Pos Style (OL/CL): 34
	* Visualization Style: MRP
	
-Decoders:
	KF0: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',3,false,[2,4],32,0,good_chans_SBP,good_chans_SBP,1,{'act_thresh',1},0,true);
		SBP KF correlation = 0.79408
			
	NN0: multilayer (standard sizes) with scheduler

	NN1: GRU
		input_size = 96
		conv_size = 20
		hidden_size = 350
		num_states = 2
		num_layers = 2
		dropout_p = 0.3
		model_type = 'RNNDecoders.GRUModel'
		scaler_type = 'regression' 
		binsize = 32
		
		Corrs = 0.7, 0.64
		
	NN2: LSTM
		Corrs = 0.69, 0.58	
		
	KF1: TrainOnline_Cortical_KalmanFilter_Multi('Joker','',10,false,[2,4],32,0,good_chans_SBP,good_chans_SBP,1,{'act_thresh',1},0,true);
		SBP KF correlation = 0.72839
	
	NN3: willseynet (TS29 trained) (stopped at 3500 iters)
		Test Correlation:[0.683859760340407, 0.7558399226189179]
	
	NN4: GRU (TS29 trained) (trained using scheduler)
		Test Correlation:[0.7425108806321485, 0.8087640848564596]
		the velocity decode plot looked really good during training
		
	NN5 GRU - same as above, just another version
		Test Correlation:[0.7356828417397111, 0.7947610316997273]
	
-Runs:
	Run 1: Calibration
	Run 2: 100 warmup, 1min break
	Run 3: TS34 - 400 training. BR~4.2-4.6
	Run 4: TS34 - 100 validation. BR~3.1-3.5
	~10 min Training Break~
	
	Run 5: TS34 - NN0 (FNN) - 200 trials - at end BR~2.0. Either moves super slow or super fast - not enough mid-range velocities, but overall well-controlled
	Run 6: TS34 - NN1 (LSTM) - 140 trials - RNN working! More midrange velocities than the FNN - slightly less stopping control, but looks overall a little better
		Trial ~50 got stuck in splits. Index hard to control. Trial 50-100 working well for a few trials then IDX getting stuck. Tends to get stuck in split. Works fine after manual decoder reset.
	Run 7: TS34 - NN1 (GRU, no scaler) - similar to LSTM with getting stuck at split (idx flex), but better control - halfway between the "sticky" fnn and the smoother lstm
		-> When it works, it looks really good for non-refit. Averaging BR~2.1 even with 2 in 20 trials getting stuck. Trial 240-400 no interruptions, let it run (last 100 BR~2.2). 
		Took him about 250-300 trials to figure out the decoder well
	Run 8: TS34 - KF0 - 150 trials - BR~2.3 - working well, but a lot more mid-range velocites - visually looks like less control, more orbiting. Doesn't get stuck
	
	Run 9: TS29 - 80 training. IDX couldn't reach the full-flex target. Adjusted the calibration after this run
	Run 10: TS29 - 500 training. BR~4.0. Still a couple times where he couldn't reach the inner target (but other times he could?)
	~10 min Training Break~
	
	Run 11: TS29 - NN3 (FNN) - 200 trials - BR~2.7. working really well - better than the first fnn, has a better range of velocities
	Run 12: TS29 - NN4 (GRU) - IDX has a small constant bias toward flex, so harder to use. Otherwise the decoder looks really good, but I think there's some motivation issues after having an amazing decoder.
	Run 13: TS29 - NN4 (GRU, no scaler) - same problem
	Run 14: TS29 - KF1 - 100 trials. BR~1.3. A lot of orbiting.
	
	**Note: anything that says 'no scaler' above this actually still had the scaler on**
	
	Run 15-16: TS29 - NN5 (GRU) still has a lot of bias or something, tried with/without scaler, and autobiasing, but didn't work. Not sure what's up
	Run 17: NN5 - still works, but not as good as before
	
	** Juice tube was out of his mouth, so the last few runs his motivation might've been extra low **
	


-Notes:

	good_chans_SBP = [1:9,11,13,15,17,23,24,33,35,37:40,43,45:47,49:53,55:60,62,64,65,67:69,71:76,78:88,90:92,95,96];	
	
	
	
	I suspect refit could help the RNNs a lot, help fix the getting stuck 
	
	I wonder if any of the getting stuck was related to how on a few hand-control trials he couldn't reach the full-flex IDX target, since the network didn't have good data in that region
	
	
	
	
	
	